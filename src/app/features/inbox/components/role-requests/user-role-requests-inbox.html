<!-- user-role-requests-inbox.html -->
<div class="user-role-requests-inbox">
  <div class="inbox-header">
    <div>
      <h2>{{ 'roleRequests.inbox.title' | translate }}</h2>
      <p class="subtitle">{{ 'roleRequests.inbox.subtitle' | translate }}</p>
    </div>

    <!-- Botones de acci√≥n con info tooltip -->
    <div class="header-actions">
      <!-- Bot√≥n de informaci√≥n -->
      <div class="info-button-wrapper">
        <button class="btn btn-info" (mouseenter)="showTooltip = true" (mouseleave)="showTooltip = false" type="button">
          <span class="icon">‚ÑπÔ∏è</span>
        </button>

        <!-- Tooltip flotante -->
        <div class="info-tooltip" [class.visible]="showTooltip">
          <div class="tooltip-header">
            <span class="tooltip-icon">‚ÑπÔ∏è</span>
            <h3>{{ 'roleRequest.info.title' | translate }}</h3>
          </div>
          <div class="tooltip-content">
            <p class="tooltip-intro">{{ 'roleRequest.info.intro' | translate }}</p>

            <div class="role-rules">
              <div class="rule-item">
                <span class="rule-icon">üîπ</span>
                <div class="rule-text">
                  <strong>{{ 'roleRequest.info.rule1.title' | translate }}</strong>
                  <p>{{ 'roleRequest.info.rule1.desc' | translate }}</p>
                </div>
              </div>

              <div class="rule-item">
                <span class="rule-icon">üîπ</span>
                <div class="rule-text">
                  <strong>{{ 'roleRequest.info.rule2.title' | translate }}</strong>
                  <p>{{ 'roleRequest.info.rule2.desc' | translate }}</p>
                </div>
              </div>

              <div class="rule-item">
                <span class="rule-icon">üîπ</span>
                <div class="rule-text">
                  <strong>{{ 'roleRequest.info.rule3.title' | translate }}</strong>
                  <p>{{ 'roleRequest.info.rule3.desc' | translate }}</p>
                </div>
              </div>

              <div class="rule-item">
                <span class="rule-icon">üîπ</span>
                <div class="rule-text">
                  <strong>{{ 'roleRequest.info.rule4.title' | translate }}</strong>
                  <p>{{ 'roleRequest.info.rule4.desc' | translate }}</p>
                </div>
              </div>
            </div>

            <div class="tooltip-footer">
              <span class="info-icon">üí°</span>
              <p>{{ 'roleRequest.info.footer' | translate }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Bot√≥n nuevo -->
      <button *ngIf="hasCompleteProfile && isVerified" class="btn btn-primary" (click)="openModal()">
        <span class="icon">+</span>
        {{ 'roleRequests.inbox.newBtn' | translate }}
      </button>

      <!-- Badge verificaci√≥n requerida -->
      <div *ngIf="!isVerified" class="verification-required-warning">
        <span class="icon">‚ö†Ô∏è</span>
        <span>{{ 'roleRequests.inbox.verifyRequiredBadge' | translate }}</span>
      </div>

      <div *ngIf="!hasCompleteProfile && isVerified" class="incomplete-profile-warning">
        <span class="icon">‚ö†Ô∏è</span>
        <span>{{ 'roleRequests.inbox.completeProfileRequired' | translate }}</span>
      </div>
    </div>
  </div>

  <!-- Mensaje si no est√° verificado -->
  <div *ngIf="!loading && !error && !isVerified" class="verification-required-state">
    <div class="warning-icon">üîí</div>
    <h3>{{ 'roleRequests.inbox.verifyRequiredTitle' | translate }}</h3>
    <p>{{ 'roleRequests.inbox.verifyRequiredDesc' | translate }}</p>
  </div>

  <div *ngIf="loading" class="loading">{{ 'roleRequests.inbox.loading' | translate }}</div>

  <div *ngIf="error && !loading" class="error-message">
    <span class="icon">‚ùå</span>
    {{ error }}
    <button class="btn-link" (click)="loadRequests()">{{ 'roleRequests.inbox.errorRetry' | translate }}</button>
  </div>

  <!-- Empty state (verificado) -->
  <div *ngIf="isVerified && !loading && !error && requests.length === 0" class="empty-state">
    <div class="empty-icon">üìã</div>
    <h3>{{ 'roleRequests.inbox.emptyTitle' | translate }}</h3>
    <p>
      {{ hasCompleteProfile
      ? ('roleRequests.inbox.emptyDescVerified' | translate)
      : ('roleRequests.inbox.emptyDescIncomplete' | translate) }}
    </p>
    <button *ngIf="hasCompleteProfile" class="btn btn-primary" (click)="openModal()">
      {{ 'roleRequests.inbox.createFirstBtn' | translate }}
    </button>
  </div>

  <!-- Listado -->
  <div *ngIf="isVerified && !loading && !error && requests.length > 0" class="requests-list">
    <app-role-request-card *ngFor="let request of requests" [request]="request"
      [isAdmin]="false"></app-role-request-card>
  </div>

  <!-- Modal -->
  <app-role-request-modal *ngIf="hasCompleteProfile && isVerified" [isOpen]="isModalOpen" [currentRoles]="currentRoles"
    (close)="closeModal()" (requestSubmitted)="handleRequestSubmitted()">
  </app-role-request-modal>
</div>